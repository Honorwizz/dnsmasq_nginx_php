# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∑–∞–¥–∞—á —Å Ansible

## üìå –û–ø–∏—Å–∞–Ω–∏–µ
–≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω Ansible Playbook/Role –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Ansible. –í–∫–ª—é—á–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É DNS-—Å–µ—Ä–≤–µ—Ä–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤ —Å PHP –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–µ—à–∏—Ä—É—é—â–µ–≥–æ DNS-—Å–µ—Ä–≤–µ—Ä–∞ dnsmasq (dnsmasq_setup.yml)
**–®–∞–≥–∏:**
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–∏—Å dnsmasq.
- –ù–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `/etc/dnsmasq.conf`.
- –î–æ–±–∞–≤–ª–µ–Ω—ã –≤–Ω–µ—à–Ω–∏–µ DNS-—Å–µ—Ä–≤–µ—Ä—ã (Google DNS).
- –°–ª—É–∂–±–∞ –≤–∫–ª—é—á–µ–Ω–∞ –∏ –∑–∞–ø—É—â–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã.

üìå **–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥—É–ª–∏:** `apt`, `template`, `systemd`

---
### 2Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π superusers —Å –ø—Ä–∞–≤–∞–º–∏ sudo (superusers_setup.yml)
**–®–∞–≥–∏:**
- –°–æ–∑–¥–∞–Ω–∞ –≥—Ä—É–ø–ø–∞ `superusers`.
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ `user2` –∏ `user3` –≤ –≥—Ä—É–ø–ø—É `superusers`.
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ —Ñ–∞–π–ª–µ `/etc/sudoers.d/superusers`, –ø–æ–∑–≤–æ–ª—è—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sudo`.
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞ sudoers —á–µ—Ä–µ–∑ `visudo`.

üìå **–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥—É–ª–∏:** `group`, `user`, `lineinfile`

---
### 3Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ nginx + php-fpm (nginx_php_setup.yml)
**–®–∞–≥–∏:**
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã `nginx` –∏ `php-fpm`.
- –ù–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª nginx (`/etc/nginx/sites-available/default`).
- –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –≤–µ–±-–∫–æ–Ω—Ç–µ–Ω—Ç–∞ `/var/www/html`.
- –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `index.php` —Å `phpinfo()`.
- –í–∫–ª—é—á–µ–Ω—ã –∏ –∑–∞–ø—É—â–µ–Ω—ã —Å–ª—É–∂–±—ã `nginx` –∏ `php-fpm`.

üìå **–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥—É–ª–∏:** `apt`, `template`, `file`, `copy`, `systemd`

---
### 4Ô∏è‚É£ –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx + php-fpm (nginx_php_advanced.yml)
**–®–∞–≥–∏:**
- –ò–∑–º–µ–Ω—ë–Ω `DocumentRoot` –Ω–∞ `/opt/nginx/ansible`.
- –ü–µ—Ä–µ–Ω–µ—Å—ë–Ω `index.php` –≤ –Ω–æ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é.
- –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ `nginx` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

üìå **–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥—É–ª–∏:** `template`, `file`, `copy`, `systemd`

---

## üîπ –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ `vault.yml` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π:
```yaml
admin_password: "SuperSecurePassword123"
```
–î–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:
```bash
ansible-vault encrypt vault.yml
```

---
## üîπ –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ `hosts.yml` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞–º–∏:
```yaml
all:
  hosts:
    web_server:
      ansible_host: 192.168.1.100
      ansible_user: your_user
      ansible_ssh_private_key_file: ~/.ssh/id_rsa
```

---
## üìå –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Ansible:

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ö–æ—Å—Ç–æ–≤:
```bash
ansible all -i hosts.yml -m ping
```

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö:
```bash
ansible all -i hosts.yml -m command -a "uptime"
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ nginx + php-fpm (nginx_php_manage.yml)
**–®–∞–≥–∏:**
- –ü—Ä–∏ `--tags install_nginx_php` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `nginx` –∏ `php-fpm`.
- –ü—Ä–∏ `--tags remove_nginx_php` —É–¥–∞–ª—è–µ—Ç—Å—è `nginx` –∏ `php-fpm`.

üìå **–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥—É–ª–∏:** `apt`, `systemd`

---
## üìå –ó–∞–ø—É—Å–∫ Playbook'–æ–≤
### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ dnsmasq:
```bash
ansible-playbook -i hosts.yml dnsmasq_setup.yml
```
### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π superusers:
```bash
ansible-playbook -i hosts.yml superusers_setup.yml
```
### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ nginx + php-fpm:
```bash
ansible-playbook -i hosts.yml nginx_php_setup.yml
```
### –ò–∑–º–µ–Ω–µ–Ω–∏–µ DocumentRoot –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx:
```bash
ansible-playbook -i hosts.yml nginx_php_advanced.yml
